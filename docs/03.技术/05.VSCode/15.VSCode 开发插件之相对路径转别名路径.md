---
title: VSCode å¼€å‘æ’ä»¶ä¹‹ç›¸å¯¹è·¯å¾„è½¬åˆ«åè·¯å¾„
date: 2022-11-06 11:18:59
permalink: /pages/0473ca/
categories:
  - æŠ€æœ¯
  - VSCode
tags:
  - VSCode æ’ä»¶
  - VSCode
---

åœ¨ä¸Šç¯‡[ç›¸å¯¹è·¯å¾„è½¬åˆ«åè·¯å¾„ä¹‹ chokidar](https://tsz.netlify.app/pages/2c6a63/) ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `chokidar` å®Œæˆäº†è‡ªåŠ¨å°†ç›¸å¯¹è·¯å¾„è½¬ä¸ºåˆ«åè·¯å¾„ï¼Œä½†è¿˜æ˜¯æœ‰äº›é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ `VSCode` æ’ä»¶å®ç°ä¸€ä¸‹è¯¥åŠŸèƒ½

å¤§ä½“æ€è·¯å°±æ˜¯ï¼šæ‰¾çš„éœ€è¦æ›¿æ¢çš„ç›¸å¯¹è·¯å¾„ï¼Œå°†å…¶è½¬æ¢ä¸ºåˆ«åè·¯å¾„ï¼Œç„¶åè°ƒç”¨ `VSCode` çš„æ›¿æ¢å‡½æ•°å°†å…¶æ›¿æ¢

## åˆå§‹åŒ–æ’ä»¶

å…ˆçœ‹è¿™é‡Œï¼š[VSCode å¼€å‘æ’ä»¶ä¹‹åˆè¯†](/pages/c23aed/)

ç„¶åæˆ‘ä»¬æ”¹ä¸€ä¸‹æ’ä»¶çš„è§¦å‘å‘½ä»¤ï¼šå°† `helloWorld` ä¿®æ”¹ä¸º `relative2alias`

## å¦‚ä½•è·å–ç›¸å¯¹è·¯å¾„

ä½¿ç”¨ `chokidar` æ—¶æˆ‘ä»¬æ˜¯ä½¿ç”¨æ­£åˆ™æ¥è·å–ç›¸å¯¹è·¯å¾„ï¼Œè¿™æ¬¡æˆ‘ä»¬æ¢ä¸€ç§æ–¹å¼ï¼Œä½¿ç”¨ `AST` è·å–

### è®¤è¯† AST

æµ‹è¯•åœ°å€ï¼š[AST explorer](https://astexplorer.net/)

ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š

![](../../.vuepress/public/img/vscode/155.png)

å¯ä»¥çœ‹åˆ°ï¼Œ`AST` å‡†ç¡®çš„æ‰¾åˆ°äº†å¼•ç”¨çš„è·¯å¾„ï¼Œè¿™å¯æ¯”æˆ‘ä»¬è‡ªå·±å†™æ­£åˆ™å¿«å¤šäº†ï¼Œè€Œä¸”å‡†ç¡®æ€§ä¹Ÿæœ‰ä¿è¯

é¦–å…ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨ [@babel/parser](https://babel.dev/docs/en/babel-parser) åŠ [@babel/traverse](https://babel.dev/docs/en/babel-traverse):

```
pnpm i @babel/parser @babel/traverse
```

`parser` ç”Ÿæˆ `AST` æ ‘ï¼Œ`traverse` å¯ä»¥éå† `AST` æ ‘

### ä½¿ç”¨ @babel/parser

ç„¶åæˆ‘ä»¬åœ¨ `src` ä¸‹æ–°å»º `main.ts` æ–‡ä»¶ï¼Œç®€å•æµ‹è¯•ä¸€ä¸‹ï¼š

```ts
import { parse } from '@babel/parser'

export function getRelativePath(code: string) {
  const ast = parse(code, {
    sourceType: 'module'
  })
  console.log('ğŸš€ ~ file: main.ts ~ line 5 ~ getRelativePath ~ ast', ast)
}
```

è¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼š

ç”±äºæˆ‘ä»¬è¿™é‡Œéƒ½ä½¿ç”¨çš„æ˜¯ `import` å’Œ `export`ï¼Œ

æ•… `pages` çš„ç¬¬äºŒä¸ªå‚æ•°å¿…é¡»å¡«å†™ `sourceType: 'module'`ï¼ˆé»˜è®¤æ˜¯ `script`ï¼‰ï¼Œå¦åˆ™ä¼šæŠ¥ï¼š

```
Command 'xxx' resulted in an error ('import' and 'export' may appear only with 'sourceType: "module"' (2:4))
```

ä¸æ˜¯ eslint é…ç½®æœ‰è¯¯ï¼ˆå¦‚æœä½ åœ¨ç½‘ä¸Šæœç´¢æ—¶ï¼Œå¤§éƒ¨åˆ†éƒ½æç¤ºä¿®æ”¹ eslint é…ç½®ï¼‰ï¼Œè€Œæ˜¯ parse éœ€è¦ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°

å…·ä½“å‚è§[å®˜æ–¹ä¾‹å­](https://babel.docschina.org/docs/en/babel-parser/#example)

æ‰€ä»¥å½“ä½ åœ¨ç½‘ä¸ŠæŸ¥è¯¢çš„è§£å†³æ–¹æ³•æ— æ•ˆæ—¶ï¼Œé˜…è¯»å®˜æ–¹æ–‡æ¡£æ˜¯æœ€å¿«çš„è§£å†³æ–¹å¼

ç„¶åè°ƒç”¨ä¸€ä¸‹

```ts
const code = `
import {
  format,
  formatDate,
  formatTime,
  isObject,
  isArray,
  getCookie,
  listToTree
} from '../../../utils'
  `
getRelativePath(code)
```

å°±å¾—åˆ°å¦‚ä¸‹çš„è¾“å‡ºï¼š

```
ğŸš€ ~ file: main.ts ~ line 8 ~ getRelativePath ~ ast Node {
  type: 'File',
  start: 0,
  end: 123,
  loc: SourceLocation {
    start: Position { line: 1, column: 0, index: 0 },
    end: Position { line: 11, column: 2, index: 123 },
    filename: undefined,
    identifierName: undefined
  },
  errors: [],
  program: Node {
    type: 'Program',
    start: 0,
    end: 123,
    loc: SourceLocation {
      start: [Position],
      end: [Position],
      filename: undefined,
      identifierName: undefined
    },
    sourceType: 'module',
    interpreter: null,
    body: [ [Node] ],
    directives: []
  },
  comments: []
}
```

`AST` æ ‘ç”Ÿæˆå®Œæˆï¼Œæ¥ä¸‹æ¥å°±éœ€è¦ä½¿ç”¨ `traverse` éå†æ ‘

### ä½¿ç”¨ @babel/traverse

å¼•å…¥ `traverse`:

```ts
import traverse from '@babel/traverse'
```

å‘ç°æœ‰æŠ¥é”™ï¼š

![](../../.vuepress/public/img/vscode/156.png)

é‚£æˆ‘ä»¬å°±æŒ‰ç…§æç¤ºå®‰è£…ä¸€ä¸‹ï¼š

```
pnpm i --save-dev @types/babel__traverse
```

ç„¶åæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸‹ï¼š

```ts
import { parse } from '@babel/parser'
import traverse from '@babel/traverse'

export function getRelativePath(code: string) {
  const ast = parse(code, {
    sourceType: 'module'
  })

  traverse(ast, {
    ImportDeclaration(path) {
      console.log('ğŸš€ ~ file: main.ts ~ line 11 ~ ImportDeclaration ~ path', path)
    }
  })
}
```

ç„¶åå†è°ƒç”¨ä¸€ä¸‹ `getRelativePath`ï¼Œç”±äºè¾“å‡ºæœ‰ç‚¹é•¿ï¼Œè¿™é‡Œå°±ä¸å±•ç¤ºäº†

é€šè¿‡è¾“å‡ºæˆ‘ä»¬å‘ç° `path.node` ä¸æˆ‘ä»¬åœ¨ `AST` æµ‹è¯•åœ°å€è¾“å‡ºçš„ä¸€è‡´

è€Œæˆ‘ä»¬åªéœ€è¦ `path.node.source`ï¼Œè¾“å‡ºä¸€ä¸‹ï¼š

```
ğŸš€ ~ file: main.ts ~ line 11 ~ ImportDeclaration ~ path Node {
  type: 'StringLiteral',
  start: 104,
  end: 120,
  loc: SourceLocation {
    start: Position { line: 10, column: 7, index: 104 },
    end: Position { line: 10, column: 23, index: 120 },
    filename: undefined,
    identifierName: undefined
  },
  extra: { rawValue: '../../../utils', raw: "'../../../utils'" },
  value: '../../../utils'
}
```

å‘ç° `value` å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ç›¸å¯¹è·¯å¾„ï¼Œè¿™å¯æ¯”æˆ‘ä»¬å½“åˆå“¼å“§å“¼å“§å†™åŠå¤©æ­£åˆ™å¿«å¤šäº†

ä¸è¿‡å¯¹äºé‚£äº›ä¸æ˜¯ç›¸å¯¹è·¯å¾„çš„ `value`ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¿‡æ»¤ä¸€ä¸‹

### ä½¿ç”¨æ­£åˆ™è¿‡æ»¤ç›¸å¯¹è·¯å¾„

è¿™é‡Œæˆ‘ä»¬å°±è¿˜æ˜¯ç”¨ç°æˆçš„æ­£åˆ™ï¼š/\.{1,2}\/.+/

```ts
const relativeReg = /\.{1,2}\/.+/
const relativePaths: string[] = []
traverse(ast, {
  ImportDeclaration(path) {
    const value = path.node.source.value
    if (relativeReg.test(value)) {
      relativePaths.push(value)
    }
  }
})
return relativePaths
```

è°ƒç”¨ä¸€ä¸‹ï¼š

```ts
const code = `
import React, { useEffect } from 'react'
import { useImmer } from 'use-immer'
import { Tree, Radio } from 'antd'

// relative start
import { useStore } from '../../store'
import {
  format,
  formatDate,
  formatTime,
  isObject,
  isArray,
  getCookie,
  listToTree
} from '../../../utils'
import interfaceName from './interface'
import logo from '../../../assets/images/logo.png'
// relative end

import './index.scss'
  `
const relativePaths = getRelativePath(code)
console.log('ğŸš€ ~ file: main.spec.ts ~ line 28 ~ test ~ relativePaths', relativePaths)
```

è¾“å‡ºï¼š

```
ğŸš€ ~ file: main.spec.ts ~ line 28 ~ test ~ relativePaths [
  '../../store',
  '../../../utils',
  './interface',
  '../../../assets/images/logo.png',
  './index.scss'
]
```

å‘ç°æŠŠ `.scss` ä¹Ÿè¿‡æ»¤å‡ºæ¥äº†ï¼Œè¿™ä¸ªæˆ‘ä»¬è¦ç‰¹æ®Šå¤„ç†ä¸€ä¸‹

ä¿®æ”¹ä¸€ä¸‹æ­£åˆ™è¡¨è¾¾å¼ï¼š`/\.{1,2}\/.+(?<!.scss)$/`ï¼Œæ’é™¤ä»¥ `.scss` ç»“å°¾çš„å¼•ç”¨è·¯å¾„

å†æµ‹è¯•ä¸€ä¸‹ï¼š

```
ğŸš€ ~ file: main.spec.ts ~ line 28 ~ test ~ relativePaths [
  '../../store',
  '../../../utils',
  './interface',
  '../../../assets/images/logo.png'
]
```

å¥½ï¼Œå®Œç¾

## ç›¸å¯¹è·¯å¾„å¦‚ä½•è½¬åˆ«åè·¯å¾„

å€Ÿé‰´ä»¥å‰çš„ç»éªŒï¼š

```ts
const path = require('path')
const sep = path.sep

// ...

const filePath = '/Users/name/Documents/workspace/src/pages/Admin/HelloWorld/index.tsx'
const relativePaths = getRelativePath(code)
const aliasPaths = relativePaths.map(item => {
  const absolutePath = path.normalize(path.join(path.parse(filePath).dir, item))
  const aliasPath = '@/' + absolutePath.split(`src${sep}`)[1].replace(/\\/g, '/')
  return aliasPath
})
console.log('ğŸš€ ~ file: main.spec.ts ~ line 33 ~ test ~ aliasPaths', aliasPaths)
```

è¾“å‡ºï¼š

```
ğŸš€ ~ file: main.spec.ts ~ line 33 ~ test ~ aliasPaths [
  '@/pages/store',
  '@/utils',
  '@/pages/Admin/HelloWorld/interface',
  '@/assets/images/logo.png'
]
```

è¿™é‡Œçš„ `filePath` æ˜¯æˆ‘ä»¬å†™æ­»çš„ï¼Œéœ€è¦æ”¹æˆåŠ¨æ€è·å–

ç”±äºä»¥å‰éƒ½æ˜¯ `chokidar` ç»™æˆ‘ä»¬æä¾›çš„ï¼Œä½†ç°åœ¨å·²ç»ä¸ä½¿ç”¨äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½ä» `VSCode` ä¸Šæ‰¾æ‰¾äº†

### åŠ¨æ€è·å– filePath

é€šè¿‡ç®€å•çš„æœç´¢å³å¯å¾—åˆ°å¦‚ä¸‹æ–¹æ³•ï¼š

```ts
vscode.window.activeTextEditor?.document.fileName
```

åœ¨ `extension.ts` æ–‡ä»¶é‡ŒéªŒè¯ä¸€ä¸‹ï¼š

```ts
import * as vscode from 'vscode'

export function activate(context: vscode.ExtensionContext) {
  let disposable = vscode.commands.registerCommand('relative2alias.relative2alias', () => {
    console.log(vscode.window.activeTextEditor?.document.fileName)
  })

  context.subscriptions.push(disposable)
}

export function deactivate() {}
```

å¯åŠ¨è°ƒè¯•å¹¶æ‰“å¼€ `index.tsx`ï¼Œè°ƒç”¨ `relative2alias` åå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š

```
/Users/name/Documents/workspace/src/pages/Admin/HelloWorld/index.tsx
```

### åŠ¨æ€è·å– code

åŒæ ·çš„ï¼Œ`code` æˆ‘ä»¬ä¹Ÿéœ€è¦åŠ¨æ€è·å–ä¸€ä¸‹ï¼š

```ts
vscode.window.activeTextEditor?.document.getText()
```

è¿™æ ·æˆ‘ä»¬å°±æ‹¿åˆ°æ•´ä¸ªæ–‡ä»¶çš„å†…å®¹äº†ï¼Œè¾“å‡ºä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œè¿™é‡Œå°±ä¸å±•ç¤ºäº†

ç„¶åæˆ‘ä»¬å°†è·å–çš„ `text` ä¼ å…¥ `getRelativePath` éªŒè¯ä¸€ä¸‹

```ts
const disposable = vscode.commands.registerCommand('relative2alias.relative2alias', () => {
  const { activeTextEditor } = vscode.window
  if (!activeTextEditor) {
    return
  }
  const document = activeTextEditor.document
  const fileName = document.fileName
  const text = document.getText()
  const relativePaths = getRelativePath(text)
  console.log('ğŸš€ ~ file: extension.ts ~ line 14 ~ disposable ~ relativePaths', relativePaths)
})
```

è°ƒç”¨ä»¥åç«Ÿç„¶æŠ¥é”™äº†ï¼š

```
Command 'relative2alias' resulted in an error (Missing semicolon. (8:7))
```

ç”±äºæ²¡æœ‰çœ‹åˆ°è¯¦ç»†æŠ¥é”™ä¿¡æ¯ï¼Œä½¿ç”¨ `try catch` è·å–ä¸€ä¸‹ï¼š

```ts
try {
  const relativePaths = getRelativePath(text)
  console.log('ğŸš€ ~ file: extension.ts ~ line 14 ~ disposable ~ relativePaths', relativePaths)
} catch (error) {
  console.log('ğŸš€ ~ file: extension.ts ~ line 17 ~ disposable ~ error', error)
}
```

æŸ¥çœ‹æŠ¥é”™ä¿¡æ¯å‘ç°å¥½åƒæ˜¯ babel parser æŠ¥çš„è¯­æ³•é”™è¯¯ï¼šbabel parser syntax errorï¼š

```
{code: 'BABEL_PARSER_SYNTAX_ERROR', reasonCode: 'MissingSemicolon', loc: Position, pos: <accessor>, stack: 'SyntaxError: Missing semicolon. (8:7)
```

åˆæ­¥çŒœæµ‹æ˜¯ç”±äº `jsx` è¯­æ³•å¼•èµ·çš„

æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦çœ‹ä¸€ä¸‹ `parse` çš„æ–‡æ¡£

åœ¨ `babel` ç»™å‡ºçš„[ä¾‹å­](https://babel.dev/docs/en/babel-parser#example)ä¸­å°±å¯ä»¥çŸ¥é“ï¼Œå¯ä»¥é€šè¿‡ `plugins` æ·»åŠ ä¸€äº›æ’ä»¶ï¼Œå…¶ä¸­å°±æœ‰è¯­è¨€æ’ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠ `jsx` å’Œ `typescript` éƒ½æ·»åŠ ä¸Šå†è¯•è¯•ï¼š

```ts
const ast = parse(code, {
  sourceType: 'module',
  plugins: ['jsx', 'typescript']
})
```

æµ‹è¯•é€šè¿‡ï¼Œè¾“å‡ºä¹Ÿæ²¡æœ‰é—®é¢˜

ok, å®Œç¾

æ³¨ï¼šè¿™é‡Œåªè§£å†³äº†è¯­æ³•çš„é—®é¢˜ï¼Œå¯èƒ½è¿˜æœ‰åˆ«çš„é—®é¢˜ï¼Œæ¯”å¦‚ `options` ä¸­çš„ `allowImportExportEverywhere`: By default, import and export declarations can only appear at a program's top level. Setting this option to true allows them anywhere where a statement is allowed.(é»˜è®¤æƒ…å†µä¸‹ï¼Œimport å’Œ export å£°æ˜åªèƒ½å‡ºç°åœ¨ç¨‹åºçš„é¡¶å±‚ã€‚å¦‚æœå°†æ­¤é€‰é¡¹è®¾ç½®ä¸º trueï¼Œåˆ™å…è®¸åœ¨ä»»ä½•å…è®¸ä½¿ç”¨è¯­å¥çš„åœ°æ–¹ä½¿ç”¨å®ƒä»¬ã€‚)ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥å®Œå–„ `options` åŠ `plugins`

## ç›¸å¯¹è·¯å¾„æ›¿æ¢ä¸ºåˆ«åè·¯å¾„

è¿™é‡Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ `VSCode` æä¾›çš„æ–¹æ³•å°†ç›¸å¯¹è·¯å¾„æ›¿æ¢ä¸ºåˆ«åè·¯å¾„

### replace æ–¹æ³•

```ts
/**
  * Replace a certain text region with a new value.
  * You can use \r\n or \n in `value` and they will be normalized to the current {@link TextDocument document}.
  *
  * @param location The range this operation should remove.
  * @param value The new text this operation should insert after removing `location`.
  */
replace(location: Position | Range | Selection, value: string): void;
```

è¿™é‡Œçš„ `replace` æ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªèŒƒå›´ï¼Œå’Œæˆ‘ä»¬å¹³æ—¶ç”¨çš„ `replace` ä¸åŒï¼ˆç¬¬ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦æ›¿æ¢çš„å­—ç¬¦ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ›¿æ¢åçš„å­—ç¬¦

ä½†æˆ‘ä»¬ç°åœ¨åªæœ‰æ›¿æ¢å‰çš„å­—ç¬¦å’Œæ›¿æ¢åçš„å­—ç¬¦ï¼Œæ‰€ä»¥è¿˜éœ€è¦è·å–æ›¿æ¢èŒƒå›´

æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹ `Position` éœ€è¦å“ªäº›å‚æ•°ï¼š

```ts
/**
 * Represents a line and character position, such as
 * the position of the cursor.
 *
 * Position objects are __immutable__. Use the {@link Position.with with} or
 * {@link Position.translate translate} methods to derive new positions
 * from an existing position.
 */
export class Position {
  /**
   * The zero-based line value.
   */
  readonly line: number

  /**
   * The zero-based character value.
   */
  readonly character: number
}
```

è¿™ä¸ª `line` æˆ‘ä»¬å¥½åƒåœ¨ `AST` é‚£é‡Œè§è¿‡ï¼š

```
loc: SourceLocation {
  start: Position { line: 10, column: 7, index: 104 },
  end: Position { line: 10, column: 23, index: 120 },
  filename: undefined,
  identifierName: undefined
}
```

è¿™ä¸ª `start` å’Œ `end` è²Œä¼¼æ­£å¥½æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠè¿™äº›å‚æ•°ä¹Ÿè¿”å›å‡ºå»

```ts
traverse(ast, {
  ImportDeclaration(path) {
    const source = path.node.source
    const value = source.value
    if (relativeReg.test(value)) {
      const start = source.loc!.start
      const end = source.loc!.end
      relativePaths.push({ value, start, end })
    }
  }
})
```

### æ‰§è¡Œ replace

ç„¶åæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ `replace` æ‰§è¡Œæ›¿æ¢é€»è¾‘äº†ï¼š

```ts
const relativePaths = getRelativePath(text)

relativePaths.map(({ value, start, end }) => {
  const absolutePath = path.normalize(path.join(path.parse(fileName).dir, value))
  const aliasPath = '@/' + absolutePath.split(`src${sep}`)[1].replace(/\\/g, '/')
  activeTextEditor.edit(editBuilder => {
    editBuilder.replace(
      new vscode.Range(
        new vscode.Position(start.line, start.column),
        new vscode.Position(end.line, end.column)
      ),
      aliasPath
    )
  })
})
```

è¾“å‡ºï¼š

```
import { useStore } from '../../store'
import {@/pages/store
  format,
  formatDate,
  formatTime,
  isObject,
  isArray,
  getCookie,
  listToTree
} from '../../../utils'
import interfaceName from './interface'
import logo from '../../../assets/images/logo.png'
```

### æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š

1. åªæœ‰ store æ‰§è¡Œäº†æ›¿æ¢ï¼Œä¹Ÿå°±æ˜¯åªæ›¿æ¢äº†ä¸€æ¬¡
2. æ›¿æ¢ç»“æœè¡Œæ•°é”™ä½äº†ï¼Œä¸‹ç§»äº†ä¸€è¡Œ

å…ˆçœ‹é”™ä½é—®é¢˜ï¼Œè¿™æ˜¯ç”±äº `@babel/parser` çš„ `startLine: By default, the parsed code is treated as if it starts from line 1, column 0.` ä¸ `vscode` çš„ `line A zero-based line value.` ä¸åŒ

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»™ `parser` æŒ‡å®šä¸€ä¸‹ `startLine`:

```ts
const ast = parse(code, {
  sourceType: 'module',
  startLine: 0,
  plugins: ['jsx', 'typescript']
})
```

å†è¯•ä¸€ä¸‹ï¼Œè¾“å‡ºï¼š

```
import { useStore } from @/pages/store
import {
  format,
  formatDate,
  formatTime,
  isObject,
  isArray,
  getCookie,
  listToTree
} from '../../../utils'
import interfaceName from './interface'
import logo from '../../../assets/images/logo.png'
```

é”™ä½é—®é¢˜è§£å†³äº†ï¼Œä½†å¼•å·åˆæ²¡äº†

è¿™æ˜¯å› ä¸º `AST` æŠŠå¼•å·ä¹ŸåŒ…å«äº†ï¼Œå®é™…åŒ¹é…çš„å€¼æ˜¯å­˜å‚¨åœ¨ `raw` çš„ï¼Œè€Œæˆ‘ä»¬ä½¿ç”¨çš„ `value` æ˜¯è¢«å¤„ç†è¿‡çš„

é‚£æˆ‘ä»¬ä½¿ç”¨ `raw` å†é‡æ–°å¤„ç†ä¸€ä¸‹å—ï¼Ÿè¿˜éœ€è¦è€ƒè™‘å•å¼•å·è¿˜æ˜¯åŒå¼•å·å‘¢

è¿™é‡Œæˆ‘ä»¬å–ä¸ªå·§ï¼Œç›´æ¥æŠŠæ›¿æ¢èŒƒå›´ç¼©å°ä¸€ä¸‹ï¼š

```ts
editBuilder.replace(
  new vscode.Range(
    new vscode.Position(start.line, start.column + 1),
    new vscode.Position(end.line, end.column - 1)
  ),
  aliasPath
)
```

å†éªŒè¯ä¸€ä¸‹ï¼š

```
import { useStore } from '@/pages/store'
```

å¼•å·é—®é¢˜è§£å†³äº†ï¼Œå†çœ‹ä¸€ä¸‹ä¸ºä»€ä¹ˆå°±æ›¿æ¢äº†ä¸€æ¬¡çš„é—®é¢˜

ä¸€å¼€å§‹æƒ³çš„æ˜¯éš¾é“ä¸æ”¯æŒä¸€ä¸‹æ›¿æ¢å¤šå¤„ï¼Ÿæ¯æ¬¡åªèƒ½æ›¿æ¢ä¸€å¤„ï¼Ÿ

é‚£æˆ‘ä»¬å¾—æ¢ä¸€ç§æ€ç»´æ–¹å¼äº†ï¼šä¸ `chokidar` å¤„ç†æ–¹å¼ä¸€æ ·ï¼Œå…ˆæ‹¿åˆ°æ–‡ä»¶æ‰€æœ‰å†…å®¹ï¼Œç„¶åä½¿ç”¨ `js` çš„ `replace` å…¨éƒ¨æ›¿æ¢å®Œæˆï¼Œå†ä½¿ç”¨ `vscode` çš„ `replace` å…¨æ–‡æ›¿æ¢

```ts
vscode.window.activeTextEditor.edit(editBuilder => {
  // ä»å¼€å§‹åˆ°ç»“æŸï¼Œå…¨é‡æ›¿æ¢
  const end = new vscode.Position(vscode.window.activeTextEditor.document.lineCount + 1, 0)
  const text = 'æ–°æ›¿æ¢çš„å†…å®¹'
  editBuilder.replace(new vscode.Range(new vscode.Position(0, 0), end), text)
})
```

ä½†è¿™ç§æ˜¯å…¨é‡æ›¿æ¢ï¼Œæ¯•ç«Ÿæˆ‘ä»¬éœ€è¦æ›¿æ¢çš„å†…å®¹æ¯”è¾ƒå°‘ï¼Œè¿˜æ˜¯æƒ³ç”¨é‚£ç§å¯ä»¥ç²¾ç»†åŒ–çš„æ›¿æ¢æ–¹å¼

å†çœ‹ä¸€ä¸‹ `edit` çš„æ–‡æ¡£ï¼Œå‘ç°è¿”å›ä¸€ä¸ª `Promise`

```
@return A promise that resolves with a value indicating if the edits could be applied.
```

éš¾é“åœ¨ `map` ä¸­ä½¿ç”¨éœ€è¦ `async/await`ï¼Œå†ä½¿ç”¨ `Promise.all` å¤„ç†ä¸€ä¸‹å—ï¼Ÿ

å®é™…æµ‹è¯•æ²¡æœ‰ä»»ä½•æ•ˆæœï¼Œè¿˜æ˜¯åªæ›¿æ¢ä¸€å¤„

éš¾é“ä¸èƒ½åœ¨å¾ªç¯ä¸­ä½¿ç”¨å—ï¼Ÿ

çªç„¶å‘ç°ï¼Œæˆ‘ä»¬æŠŠ `edit` åŠå…¶å›è°ƒå‡½æ•°éƒ½æ”¾åœ¨ `map` ä¸­äº†ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯åº”è¯¥åœ¨å›è°ƒå‡½æ•°ä¸­ `map` å‘¢ï¼Ÿ

```ts
activeTextEditor.edit(editBuilder => {
  relativePaths.map(({ value, start, end }) => {
    const absolutePath = path.normalize(path.join(path.parse(fileName).dir, value))
    const aliasPath = '@/' + absolutePath.split(`src${sep}`)[1].replace(/\\/g, '/')
    editBuilder.replace(
      new vscode.Range(
        new vscode.Position(start.line, start.column + 1),
        new vscode.Position(end.line, end.column - 1)
      ),
      aliasPath
    )
  })
})
```

è¾“å‡ºï¼š

```
import React, { useEffect } from 'react'
import { useImmer } from 'use-immer'
import { Tree, Radio } from 'antd'

// relative start
import { useStore } from '@/pages/store'
import {
  format,
  formatDate,
  formatTime,
  isObject,
  isArray,
  getCookie,
  listToTree
} from "@/utils"
import interfaceName from '@/pages/Admin/HelloWorld/interface'
import logo from '@/assets/images/logo.png'
// relative end

import './index.scss'
```

å®Œç¾ï¼

å½“ç„¶ï¼Œæˆ‘ä»¬è¿™é‡Œåªæ˜¯å®ç°äº†åŸºæœ¬çš„åŠŸèƒ½ï¼Œè€Œä¸”è¿˜æœ‰å¾ˆå¤šç¡¬ç¼–ç çš„åœ°æ–¹ï¼Œéœ€è¦æŒç»­çš„ç»´æŠ¤åŠé‡æ„

## å‘å¸ƒæ’ä»¶

å‚è§ï¼š[VSCode å¼€å‘æ’ä»¶ä¹‹å‘å¸ƒ](/pages/5cbda2/)

## å‚è€ƒèµ„æ–™

- [ç¼–å†™ä¸€ä¸ª Vscode æ’ä»¶ï¼Œä»åˆ›å»ºåˆ°å‘å¸ƒï¼Œä¸€é”®åˆ é™¤å‡½æ•°](https://www.bilibili.com/video/BV1bG4y1n78A)
- [å¸¦ä½ ç©è½¬ babel å·¥å…·é“¾ï¼ˆä¸€ï¼‰@babel/parser](https://juejin.cn/post/7112733626589577230)
- [å¸¦ä½ ç©è½¬ babel å·¥å…·é“¾ï¼ˆäºŒï¼‰@babel/traverse](https://juejin.cn/post/7113800415057018894)
- [ã€JSã€‘æ­£åˆ™è¡¨è¾¾å¼å–åï¼ˆä¸èƒ½ä»¥...ç»“å°¾ï¼‰](https://blog.csdn.net/qq_45677671/article/details/120350062)
- [vscode æ’ä»¶å¼€å‘ - å³é”®èœå•ï¼šè·å–é€‰ä¸­çš„æ–‡ä»¶æˆ–è€…ç›®å½•](https://blog.csdn.net/leiweip/article/details/126892769)
- [VSCode æ’ä»¶å¼€å‘å…¨æ”»ç•¥ï¼ˆä¹ï¼‰å¸¸ç”¨ API æ€»ç»“](http://blog.haoji.me/vscode-plugin-common-api.html)
