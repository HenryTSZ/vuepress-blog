---
title: 监听文件夹并处理
date: 2021-08-17 00:00:00
categories:
  - FrontEnd
  - Js
tags:
  - node
permalink: /pages/9cef33/
---

当我们长时间向文件夹中添加大量文件时, 文件命名是一个非常耗时间的问题

<!-- more -->

想象一下: 我们从 001 开始命名, 每次添加进一个文件, 都需要经历先看当前排到第几了, 再重命名, 而且没有小键盘输入数字也很麻烦

所以我们需要做一个自动重命名的工具

通过简单的计算机知识找到了这个方法:[nodejs 监听目录, 重命名文件-小朱的专栏-CSDN 博客](https://blog.csdn.net/w20101310/article/details/107165946)

但实际测试发现 `fs.watch` 的 `event` 一直都是 `rename` , 不论是新增删除修改, 这样肯定是不行的

再用计算机高级知识找到了这个: [paulmillr/chokidar: Minimal and efficient cross-platform file watching library](https://github.com/paulmillr/chokidar)

一款监听文件夹内容变化的工具

简单使用例子:

Install with npm:

```bash
npm install chokidar
```

Then require and use it in your code:

```js
const chokidar = require('chokidar')

// One-liner for current directory
chokidar.watch('.').on('all', (event, path) => {
  console.log(event, path)
})
```

以下为成果:

```js
const path = require('path')
const fs = require('fs')
const chokidar = require('chokidar')

const cwd = path.join(__dirname, 'img')
const readDir = fs.readdirSync(cwd)
let len = readDir.length

/**
 * watch(paths, [options])
 * ignoreInitial (default: false). If set to false then add/addDir events are also emitted for matching paths while instantiating the watching as chokidar discovers these file paths (before the ready event).
 * 简单理解就是对于已有文件/文件夹, 初始化的时候也会触发 add/addDir 事件
 * 我们目前只需要监听新增的文件, 所以设置为 true
 */
chokidar
  .watch(cwd, {
    ignoreInitial: true
  })
  .on('add', filePath => {
    const { name, ext } = path.parse(filePath)
    if (isNaN(+name)) {
      fs.rename(filePath, path.join(cwd, `${len.toString().padStart(3, 0)}${ext}`), err => {
        if (!err) {
          len++
        }
      })
    }
  })
```

这里只是一个简单的例子, 具体可以根据自己的需求更改
